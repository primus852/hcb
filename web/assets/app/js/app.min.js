String.prototype.escapeHTML=function(){return(this.replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;"))};var cols={},messageIsOpen=false;$(function(){startTime(1);$("input").attr("autocomplete","off");initPerfectScrollbar("#perfectScroll");initModal();initTooltips(".tt");$(window).hashchange();initMenu("#"+GetNav);initOverlays();detectHash()});function initMenu(a){$(".mLink").removeClass("active");var b=$(a);if(!b.is(":visible")){b.parent().prev("a").trigger("click")}b.addClass("active")}function initOverlays(){cols.showOverlay=function(){$("body").addClass("show-main-overlay")};cols.hideOverlay=function(){$("body").removeClass("show-main-overlay")};cols.showMessage=function(){$("body").addClass("show-message");messageIsOpen=true};cols.hideMessage=function(){$("body").removeClass("show-message").removeClass("show-main-overlay");messageIsOpen=false};cols.showSidebar=function(){$("body").addClass("show-sidebar")};cols.hideSidebar=function(){$("body").removeClass("show-sidebar")};$(".trigger-toggle-sidebar").on("click",function(){cols.showSidebar();cols.showOverlay()});$("#main > .overlay").on("click",function(){cols.hideOverlay();cols.hideMessage();cols.hideSidebar()})}$(document).on("click",".editable",function(a){a.preventDefault();return false});$(document).on("change",".changeModifier",function(){var c=$("#ajax-route-edit-mod").val();var a=$(this).val();var b=$(this).attr("id");$.get(c,{field:b,val:a}).done(function(d){openNoty(d.result,d.message)})});$(document).on("click",".trigger-message-close",function(){var a=$(this).closest(".messageFly");$(".mLink").parent().removeClass("active");if($(".messageFly").length<=1){cols.hideMessage();a.remove();history.pushState("",document.title,window.location.pathname)}else{a.animate({left:"9999px"},function(){a.remove()})}});$(document).on("click",".addEntry",function(a){a.preventDefault();openNotyAdd($(this))});function openNotyAdd(a){var b='<div class="row">\n       <div class="col-12">\n               <div class="card cardTransparent">\n                       <div class="card-body">\n                               <div class="row">\n                                       <div class="col-12">\n                                               <h4 class="card-title">'+a.attr("data-add-heading")+'</h4>\n                                               <h6 class="card-subtitle mb-2 text-muted">&nbsp;</h6>\n                                       </div>\n                               </div>\n                               <div class="row">\n                                       <div class="col-12" id="loadForm">\n                                               <i class="fa fa-spin fa-spinner"></i>\n                                       </div>\n                               </div>\n                       </div>\n               </div>\n       </div>\n</div>\n';var c=new Noty({layout:"center",text:b,type:"alert",timeout:false,theme:"mint",modal:true,closeWith:["button"],buttons:[Noty.button("Save","btn btn-success btn-sm rounded-0 btn-block pointer saveModal",function(){var g=$(this)[0]["id"];var f=$("#"+g);var d=f.html();if(f.hasClass("disabled")){return false}f.addClass("disabled").html('<i class="fa fa-spin fa-spinner"></i>');var e=[];$(".sendValue").each(function(o,l){var h=$(l).attr("data-name");var m=$(l).val();var n=$(l).attr("data-table-index");var k=$(l).attr("type");var j=$(l).attr("data-extra");if(k==="checkbox"){m=$(l).is(":checked")}var p={name:h,val:m,type:k,extra:j,index:n};e.push(p)});$.ajax({type:"GET",url:a.attr("data-url-save"),data:{data:e,parent:a.attr("data-parent-entity")},success:function(i){openNoty(i.result,i.message);if(i.result==="success"){var j=$("#"+a.attr("data-tbody-id"));var h=$('<tr id="row_'+i.extra.span+"_"+i.extra.id+'">');$.each(i.extra.fields,function(l,k){h.append('<td class="'+k.cellClass+'">   <span class="'+i.extra.span+"_"+k.name+"_"+i.extra.id+'">'+k.value+"</span></td>")});h.append('<td class="text-center">   <a href="#" class="btn btn-danger tt" title="Remove Rate"><i class="fa fa-remove"></i></a>   <a href="#" class="btn btn-warning tt" title="Edit Rate"><i class="fa fa-edit"></i></a></td>');j.append(h);c.close()}},fail:function(h){openNoty("error","Error saving data, please try again")},complete:function(){f.removeClass("disabled").html(d)}})}),Noty.button("Close","btn btn-danger btn-sm rounded-0 btn-block pointer",function(){c.close()})]}).on("afterShow",function(){$.ajax({type:"GET",url:a.attr("data-url"),success:function(d){$("#loadForm").html(d)},fail:function(d){openNoty("error","Error loading data, please try again");c.close()}})}).show()}function detectHash(){var a=window.location.hash;if(!a.length){return false}$("[data-hash="+a.replace("#","")+"]").trigger("click")}function initEditable(a){var b=$(a);if(b.length){b.editable({ajaxOptions:{type:"get"},mode:"inline",emptytext:"empty",success:function(c,d){openNoty(c.result,c.message);if(c.result!=="success"){$(this).attr("data-pk",c.newPK)}else{return{newValue:c.newValue}}}})}}$(document).on("click",".toggleTree",function(b){b.preventDefault();var c=$(this).next(".treeMenu");var a=$(this).children("i");if(c.is(":visible")){a.removeClass("fa-chevron-down").addClass("fa-chevron-right")}else{a.removeClass("fa-chevron-right").addClass("fa-chevron-down")}c.toggle(200)});$(document).on("click",".clickable",function(c){c.preventDefault();window.location.hash=$(this).attr("data-hash");var b=Math.floor((Math.random()*10000)+1);$("body").append('<div class="messageFly" id="'+b+'"></div>');var a=$("#"+b);a.show();loadDetails($(this),b);if(messageIsOpen){if(!$(this).hasClass("innerMessage")){cols.hideMessage();$(".trigger-message-close").trigger("click")}setTimeout(function(){cols.showMessage()},300)}else{cols.showMessage()}cols.showOverlay()});$(document).on("click",".initUploader",function(a){a.preventDefault();initUploader($(this).attr("data-uploader"));$(this).remove()});function loadDetails(b,c){var a=$("#"+c);a.html('<i class="fa fa-spin fa-spinner fa-4x"></i>');$.get(b.attr("data-url")).done(function(e){a.html(e);var d=window.location.hash.split("load-");if(d.length){$('[data-device="'+d[1]+'"]').trigger("click")}$("#menuToggle > input").trigger("click");initOverlays();initModal();initTooltips(".tt");initPerfectScrollbar(".subScroll");initEditable(".editable");if(b.hasClass("mLink")){initMenu(b.parent())}})}$(document).on("click",".md-close",function(b){b.preventDefault();var a=$("#modal");if($(this).hasClass("disabled")){return false}a.removeClass("md-show")});$(document).on("click",".md-trigger",function(f){f.preventDefault();var j=$(this);var i=j.attr("data-title");var b=j.attr("data-html");var h=j.attr("data-ok");var c=j.attr("data-to-revise");var g=j.attr("data-row");var k=j.attr("data-id");var d=j.attr("data-ok-url");var a=j.attr("data-parent-html");modalUpdate(i,b,h,k,d,a);if(j.attr("data-pre-url").length){$.get(j.attr("data-pre-url")).done(function(e){f.preventDefault();if(e.result==="success"){if(e.extra){b=e.extra.html;i=e.extra.title;modalUpdate(i,b,h,k,d,a,c,g)}else{openNoty(e.result,e.message)}}}).fail(function(){openNoty("error","Ajax Error")})}});function modalUpdate(j,e,c,b,f,h,k,l){var a=$("#modalTitle");var i=$("#modalText");var g=$("#mOkClass");var d=$("#mAbortClass");a.html(j);i.html(e);g.removeClass().addClass("btn").addClass("btn-success").addClass("rounded-0").addClass("btn-block").addClass(c).attr("data-id",b).attr("data-ok-url",f).attr("data-parent-html",h).attr("data-to-revise",k).attr("data-row",l);d.removeClass().addClass("btn").addClass("btn-danger").addClass("md-close").addClass("rounded-0").addClass("btn-block")}function initModal(){[].slice.call($(".md-trigger")).forEach(function(c,b){var a=$("#"+c.getAttribute("data-modal"));c.addEventListener("click",function(d){a.addClass("md-show")})})}function initPerfectScrollbar(a){var b=$(a);if(b.length){new PerfectScrollbar(a);new PerfectScrollbar("#pScrollerMenu")}}function initTimePicker(b){var a=$(b);if(a.length){a.timepicker({timeFormat:"HH:mm",interval:15,dynamic:false,dropdown:false,scrollbar:true})}}function initPickaDay(a){var b=$(a);if(b.length){new Pikaday({field:b[0],format:"DD.MM.YY"})}}function openNoty(a,b){new Noty({layout:"topRight",text:b,type:a,timeout:3000,buttons:false}).show()}function initTooltips(a){var b=$(a);b.tooltipster({theme:"tooltipster-punk",contentAsHTML:true})}function startTime(i){var a=$("#ajax-route-update-times").val();var c=$("#ajax-route-nmaster-api").val();var e=new Date();var d=e.getHours();var b=e.getMinutes();var j=e.getSeconds();var f=$("#nm-errors");b=checkTime(b);j=checkTime(j);$("#startClock").html("@"+d+":"+b+":"+j+" Uhr");var g=setTimeout(startTime,1000)}function checkTime(a){if(a<10){a="0"+a}return a}function closeModal(){$(".trigger-message-close").trigger("click")}$(window).hashchange(function(){var a=location.hash.replace(/^#/,"");if(a===""){$(".trigger-message-close").trigger("click")}});